<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="./img/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./gameStyle.css">
    <title>Theta Trinity</title>
</head>
<body style="font-family: 'Josefin Sans', sans-serif; height: 100vh; background: linear-gradient(to bottom, #9999ff 0%, #ff99cc 100%);">
    <div id="videoPlayground" style="width: 90vw; height: 90vh; margin:auto; overflow: hidden;">
        <h1 style="text-align: center;"><u>Theta Video Playground</u></h1>
        
        <div id="videoDivInfo" style="width: 90%; margin: auto; display: flex; align-items: center; justify-content: space-between;">
            <h3>Level <span id="videoLevels">0</span>/9</h3>
            <div id="videoTypes" style="display: flex;">
                <div id="environment" style="display: none; padding: 5px; background: green; color: white; border-radius: 3px; margin: 0 3px">Environment</div>
                <div id="history" style="display: none; padding: 5px; background: green; color: white; border-radius: 3px;  margin: 0 3px">History</div>
                <div id="technology" style="display: none; padding: 5px; background: green; color: white; border-radius: 3px;  margin: 0 3px">Technology</div>
            </div>
        </div>

        <!-- division where the videos & questions will be rendered -->
        <h3 style="width: 90%; margin:auto">Score: <span id="score">0</span></h3>

        <!-- Q&A division -->
        <div style=" height: 60vh; display: flex; justify-content: center; align-items: center; margin-top: 10px">
            <!-- questions & answers div -->
            <div id="questions" style="height: 90%; width:50%; background: white; border: 2px solid black; border-radius: 20px 0px 0px 20px; display: none; justify-content: center; align-items: center;">
                <!-- video timer -->
                <div id="videoTimer" style="font-size: 5rem;">
                    
                </div>
                

                <div id="qna" style="display: none;">
                </div>
            </div>
            
            <!-- video div -->
            <div id="video" style="height: 90%; width:50%; border: 2px solid black; border-radius: 0px 20px 20px 0px; display: none; justify-content: center; align-items: center;">
                <div style="display: flex; justify-content: center; align-items: center;">
                    <div id="videoPlayer" style="text-align: center">
                        <!-- will be dynamically added -->
                    </div>
                    <div id="qnaTimer" style="font-size: 5rem; display: none">
                        5
                    </div>
                </div>
            </div>

            <!-- start div that appears at the start and after giving answers / running out of time -->
            <div id="startDiv"
                style="height: 80%; width:100%; display: flex; flex-direction: column; justify-content: space-evenly; align-items: center;">
                <div>
                    <!-- <img id="correct" style="display: none" width="80" height="80" src="" alt="checked" /> -->
                    <img id="correct" style="display: none" width="100" height="100" src="https://img.icons8.com/dotty/100/FFFFFF/check-all.png" alt="check-all"/>
                    <!-- <img id="wrong" style="display: none" width="80" height="80" src="https://img.icons8.com/dotty/80/FA5252/circled-x.png" alt="circled-x" /> -->
                    <img id="wrong" style="display: none" width="100" height="100" src="https://img.icons8.com/dotty/100/FFFFFF/multiply-2.png" alt="multiply-2"/>
                </div>
                <div id="completedAllLevels" style="display: none; width: 90%; margin: auto; text-align: center; color: red; font-weight: bold; font-size: 2rem;">
                    <p>Congrats ðŸŽ‰ you have completed all of the levels. Now you can go back to the main village and play games there </p>
                </div>
                <div id="instructions" style="text-align:justify;">
                    <h2>Instrcutions to be followed for the game</h2>
                    <p>ðŸ”´ This is a trivia game that will test your presence of mind by showing you vidoes from various domains</p>
                    <p>ðŸŸ¡ For each video, you will get a stipulated time after which the video will be closed automatically</p>
                    <p>ðŸŸ¢ You can get a video from one of these categories: Environment, Technology & History</p>
                    <p>ðŸŸ  4 questions for the video will be shown which have to be completed in 30 seconds</p>
                </div>
                <div id="videoProceed">
                    <button class="btn-light" style="border-radius: 08px; font-size: 20px;">Proceed</button>
                </div>
            </div>
        </div>
    </div>

</body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"
            integrity="sha512-6+YN/9o9BWrk6wSfGxQGpt3EUK6XeHi6yeHV+TYD2GR0Sj/cggRpXr1BrAQf0as6XslxomMUxXp2vIl+fv0QRA=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="./audio.js"></script>
    <script>
        const videoPoints = 0
        const qna = document.querySelector("#qna")
        const video = document.querySelector("#video")
        const startDiv = document.querySelector("#startDiv")
        const questions = document.querySelector("#questions")
        const videoPlayer = document.querySelector("#videoPlayer")
        const instructions = document.querySelector("#instructions")
        const proceedBtn = document.querySelector("#videoProceed button")

        const wrong = document.querySelector("#wrong")
        const correct = document.querySelector("#correct")
        
        const qnaTimer = document.querySelector("#qnaTimer")
        var videoTimer = document.querySelector("#videoTimer")

        let videoLevels = document.querySelector("#videoLevels")

        let qnaInterval;
        let videoInterval;

        let wrongAns = false

        const videoURLs = [
            "https://player.thetavideoapi.com/video/video_tek0h3m6canxjdzrtcnveiu86f",
            "https://player.thetavideoapi.com/video/video_01hg0gmue0aimbig40t3uks6qr",
            "https://player.thetavideoapi.com/video/video_ebsgqrq0inxwzx4prjus8ftx9j",
            "https://player.thetavideoapi.com/video/video_895stgizzscdkdr6hgh1deqwfe",
            "https://player.thetavideoapi.com/video/video_npis7qemf93xecfttansiad5yv",
            "https://player.thetavideoapi.com/video/video_0xs3me78wy8y55nhcz9r3rcfie",
            "https://player.thetavideoapi.com/video/video_8q5zm9a8a4szmpi3fhx56f9ksr",
            "https://player.thetavideoapi.com/video/video_09u1jykx0ypssc2k2x4su6k8ny",
            "https://player.thetavideoapi.com/video/video_z653k8jvqp69x9d2gbxsui8f2k"
        ]

        const videoTracker = {
            0: {
                "type": "environment",
                "used": false,
                "questions": {
                    0: {
                        "q": "Which layer carries electrical charges?",
                        "o": ["Atmosphere", "Thermosphere", "Stratosphere", "Exosphere"],
                        "ans": "Thermosphere"
                    },
                    1: {
                        "q": "What is the range of Troposphere?",
                        "o": ["50-75 miles", "30-35 miles", "4-10 miles", "above 400 miles"],
                        "ans": "4-10 miles"
                    },
                    2: {
                        "q": "Why aeroplanes fly in the Stratosphere?",
                        "o": ["No weather disturbances", "Ions presence", "Low temperature", "High lift"],
                        "ans": "No weather disturbances"
                    },
                    3: {
                        "q": "Layer which blocks out UV rays",
                        "o": ["Thermosphere", "Stratosphere", "Troposphere", "Exosphere"],
                        "ans": "Stratosphere"
                    }
                }
            },
            1: {
                "type": "environment",
                "used": false,
                "questions": {
                    0: {
                        "q": "In a single gram of soil, how many micro-organisms can be found?",
                        "o": ["5k", "150k", "10k", "50k"],
                        "ans": "50k"
                    },
                    1: {
                        "q": "Which was fascinated by the importance of earthworms?",
                        "o": ["Aristotle", "Linnaeus", "Mendel", "Darwin"],
                        "ans": "Darwin"
                    },
                    2: {
                        "q": "How much soil is made in 100 years?",
                        "o": ["15mm", "5mm", "100mm", "7.5mm"],
                        "ans": "5mm"
                    },
                    3: {
                        "q": "Oldest found soil is present in?",
                        "o": ["India", "Australia", "South Africa", "UK"],
                        "ans": "South Africa"
                    }
                }
            },
            2: {
                "type": "environment",
                "used": false,
                "questions": {
                    0: {
                        "q": "Where do they breed?",
                        "o": ["Arctic", "Swamps", "Marshs", "Tropics"],
                        "ans": "Tropics"
                    },
                    1: {
                        "q": "Which species of whales were referred in the video?",
                        "o": ["Humpback", "Orca", "Blue", "Fin"],
                        "ans": "Humpback"
                    },
                    2: {
                        "q": "In which year, commercial whaling was banned?",
                        "o": ["1903", "1804", "1972", "1986"],
                        "ans": "1986"
                    },
                    3: {
                        "q": "Which location was picturized in the video?",
                        "o": ["South Africa", "Asia", "Antartica", "Australia"],
                        "ans": "South Africa"
                    }
                }
            },
            3: {
                "type": "technology",
                "used": false,
                "questions": {
                    0: {
                        "q": "Neural network works upon?",
                        "o": ["Classes", "Feature Detection", "Labels", "Error Detection"],
                        "ans": "Feature Detection"
                    },
                    1: {
                        "q": "AI softwares are possible due to?",
                        "o": ["Cathode Rays", "CPUs", "Transistors", "GPUs"],
                        "ans": "GPUs"
                    },
                    2: {
                        "q": "A human face can have how many facial features?",
                        "o": ["14", "10", "15", "17"],
                        "ans": "15"
                    },
                    3: {
                        "q": "Which one is not an algorithm?",
                        "o": ["RNN", "CNN", "ANN", "TNN"],
                        "ans": "TNN"
                    }
                }
            },
            4: {
                "type": "technology",
                "used": false,
                "questions": {
                    0: {
                        "q": "Which is not an OS?",
                        "o": ["macOS", "iOS", "LibOS", "Windows"],
                        "ans": "LibOS"
                    },
                    1: {
                        "q": "Google offers OS for what kind of devices?",
                        "o": ["Kiosk", "Mac", "Tablets", "Android"],
                        "ans": "Android"
                    },
                    2: {
                        "q": "OS is an intermediary between",
                        "o": ["User & computer", "Monitor & computer", "User & monitor", "CPU & printer"],
                        "ans": "User & computer"
                    },
                    3: {
                        "q": "Which is an OS offered by Apple?",
                        "o": ["MacOS", "Windows", "Linux", "Unix"],
                        "ans": "MacOS"
                    }
                }
            },
            5: {
                "type": "technology",
                "used": false,
                "questions": {
                    0: {
                        "q": "What is used in real life for encryption?",
                        "o": ["Addition", "Division", "Modulus", "Multiplication"],
                        "ans": "Modulus"
                    },
                    1: {
                        "q": "What is encryption?",
                        "o": ["Conversion to numerical value", "Scrambling a plain text", "Debugging", "Project testing"],
                        "ans": "Scrambling a plain text"
                    },
                    2: {
                        "q": "Key used by both parties to encrypt message",
                        "o": ["Public", "Private", "Foreign", "Candidate"],
                        "ans": "Public"
                    },
                    3: {
                        "q": "Terms related to cryptography",
                        "o": ["Machine Learning", "Web", "Hash & salt", "Artificial Intelligence"],
                        "ans": "Hash & salt"
                    }
                }
            },
            6: {
                "type": "history",
                "used": false,
                "questions": {
                    0: {
                        "q": "At the age of 22, Picasso moved to?",
                        "o": ["London", "New York", "Paris", "Budapest"],
                        "ans": "Paris"
                    },
                    1: {
                        "q": "Which item ignited spark in Picasso?",
                        "o": ["Cigar puff", "Graffiti", "Sparkling sun", "Music"],
                        "ans": "Cigar puff"
                    },
                    2: {
                        "q": "What was Picasso's radical art form known as?",
                        "o": ["Op art", "Suprematism", "Expressionism", "Cubism"],
                        "ans": "Cubism"
                    },
                    3: {
                        "q": "According to him, a picture is a sum of?",
                        "o": ["Contsruction", "Art & craft", "Destructions", "Additions"],
                        "ans": "Destructions"
                    }
                }
            },
            7: {
                "type": "history",
                "used": false,
                "questions": {
                    0: {
                        "q": "Who coined the termed Industrial Revolution?",
                        "o": ["James Watt", "Arnold Toynbee", "Robert Owen", "George Stephenson"],
                        "ans": "Arnold Toynbee"
                    },
                    1: {
                        "q": "What was the integral part of this revolution?",
                        "o": ["Cotton", "Iron & coal", "Steam engine", "Power loom"],
                        "ans": "Steam engine"
                    },
                    2: {
                        "q": "What helped Industrial revolution to flourish?",
                        "o": ["Blue Revolution", "White Revolution", "Green Revolution", "Agricultural Revolution"],
                        "ans": "Agricultural Revolution"
                    },
                    3: {
                        "q": "From where this revolution started?",
                        "o": ["UK", "Europe", "USA", "Asia"],
                        "ans": "UK"
                    }
                }
            },
            8: {
                "type": "history",
                "used": false,
                "questions": {
                    0: {
                        "q": "Who was fighting against Axis powers?",
                        "o": ["Japan", "Poland", "USA", "Italy"],
                        "ans": "USA"
                    },
                    1: {
                        "q": "When was atomic bomb dropped?",
                        "o": ["6 Sept 1955", "6 Aug 1945", "16 Jan 1947", "31 Jan 1943"],
                        "ans": "6 Aug 1945"
                    },
                    2: {
                        "q": "Which one is not a part of Axis powers?",
                        "o": ["Japan", "USSR", "Germany", "Italy"],
                        "ans": "USSR"
                    },
                    3: {
                        "q": "What was the timeline of the war?",
                        "o": ["1930-40", "1939-46", "1938-47", "1939-45"],
                        "ans": "1939-45"
                    }
                }
            }
        }

        const videoTime = [155, 280, 205, 120, 97, 135, 130, 235, 210]

        let randomNum;

        const qnaCountdown = () => {
            qnaTimer.textContent --;
            if(qnaTimer.textContent == 0) {
                clearInterval(qnaInterval);
                video.style.display = "none"
                questions.style.display = "none"

                startDiv.style.display = "flex"
                instructions.style.display = "none"

                // if the user has provided the correct answers
                if(
                    document.querySelector("#q1Ans").value !== "select" &&
                    document.querySelector("#q2Ans").value !== "select" &&
                    document.querySelector("#q3Ans").value !== "select" &&
                    document.querySelector("#q4Ans").value !== "select" &&
                    document.querySelector("#q1Ans").value === videoTracker[randomNum].questions[0].ans &&
                    document.querySelector("#q2Ans").value === videoTracker[randomNum].questions[1].ans &&
                    document.querySelector("#q3Ans").value === videoTracker[randomNum].questions[2].ans &&
                    document.querySelector("#q4Ans").value === videoTracker[randomNum].questions[3].ans
                ) {
                    proceedBtn.disabled = true
                    claps.play()
                    proceedBtn.disabled = false
                    wrongAns = false
                    correct.style.display = "block"
                    wrong.style.display = "none"
                    videoTracker[randomNum].used = true
                    proceedBtn.textContent = "Next question"
    
                    console.log(videoTracker[randomNum])
                } else {
                    wrongAns = true
                    wrong.style.display = "block"
                    correct.style.display = "none"
                    videoTracker[randomNum].used = false
                    proceedBtn.textContent = "Retry"
                }

                // resetting the UI assets
                qna.style.display = "none"
                qnaTimer.style.display = "none"
                videoTimer.style.display = "block"

                // emptying the question fields
                for(let a=1; a<5; a++) {
                    document.querySelector(`#q${a}`).remove()
                    document.querySelector(`#q${a}Ans`).remove()
                }

                const tags = ["technology", "environment", "history"];
                tags.forEach(el => {
                    document.querySelector(`#${el}`).style.display = "none";
                })

                video.style.background = "rgba(0,0,0,0)"
                questions.style.background = "white"
            }
        }

        const switchQuestionsAns = () => {
            qnaTimer.style.display   = "block";
            videoTimer.style.display = "none" ;
            qna.style.display        = "block";

            questions.style.background = "rgba(0,0,0,0)"
            video.style.background = "white"

            for(let a=0; a<4; a++) {
                const para = document.createElement("p")
                para.setAttribute("id", `q${a+1}`);
                para.textContent = `${a+1}. ${videoTracker[randomNum].questions[a].q}`
                qna.appendChild(para)

                const select = document.createElement("select")
                select.setAttribute("id", `q${a+1}Ans`)
                
                var option = document.createElement("option")
                option.setAttribute("value", "select")
                option.textContent = "Select"
                select.appendChild(option)
                
                for(let op=0; op<4; op++) {
                    var option = document.createElement("option")
                    option.setAttribute("value",videoTracker[randomNum].questions[a].o[op])
                    option.textContent = videoTracker[randomNum].questions[a].o[op]
                    select.appendChild(option)
                }
                qna.appendChild(select)
            }


            qnaTimer.textContent = 30;
            qnaInterval = window.setInterval(qnaCountdown, 1000)
        }

        const videoCountdown = () => {
            videoTimer.textContent--;
            if(videoTimer.textContent == 0) {
                clearInterval(videoInterval);
                document.querySelector("iframe").remove()
                switchQuestionsAns()
            }
        }

        const populateUI = () => {
            startDiv.style.display = "none"
            questions.style.display = "flex"
            video.style.display = "flex"

            videoTimer.textContent = videoTime[randomNum]
            videoInterval = window.setInterval(videoCountdown, 1000)

            const tags = ["technology", "environment", "history"];
            tags.forEach(el => {
                if (videoTracker[randomNum].type === el) {
                    document.querySelector(`#${el}`).style.display = "block";
                }
            })
        }

        const appendIframe = (src) => {
            let iframe = document.createElement("iframe")
            iframe.width = "400";
            iframe.height = "250"
            iframe.src = src
            iframe.onload = populateUI

            videoPlayer.appendChild(iframe)
        }

        document.querySelector("#videoProceed").addEventListener("click", () => {
            // generates a no between 0 and 5
            randomNum = Math.floor(Math.random() * 9); 
            
            var itr = 0;
            for(let el in videoTracker) {
                if(videoTracker[el].used) itr++
            }

            if(itr<9) {

                if(!wrongAns) {
                    if (Number(videoLevels.textContent < 9)) {
                        videoLevels.textContent = Number(videoLevels.textContent) + 1
                    }
                }

                while (videoTracker[randomNum].used) {
                    randomNum = Math.floor(Math.random() * 9);
                }

                video.style.background = "rgba(0,0,0,0)"
                questions.style.background = "white"

                appendIframe(videoURLs[randomNum]);
            } else {
                document.querySelector("#completedAllLevels").style.display = "block"
                instructions.style.display = "none"
                startDiv.style.display = "flex"
                proceedBtn.textContent = "Back to village"

                proceedBtn.addEventListener("click", () => {
                    location.href = "/"
                })

                correct.style.display = "none";
                wrong.style.display = "none"

                questions.style.display = "none"
                video.style.display = "none"
            }
        });

    </script>
</html>